# 🧪 실시간 콜 전송 테스트 가이드

## 📋 준비사항

1. ✅ 웹소켓 서버 실행 완료
2. ✅ 프론트엔드 실행 완료
3. ✅ 브라우저 콘솔에 "웹소켓 연결됨" 표시

---

## 🎬 테스트 시나리오

### 방법 1: 두 개의 브라우저 탭 사용

#### 탭 1: 고객 (콜 보내기)
1. 일반 탭에서 앱 열기
2. **고객 계정**으로 로그인
3. "짐 보관하기" 또는 "짐 배달하기" 선택
4. 가게 선택
5. **결제하기** 클릭
6. 결제 완료! 🎉

#### 탭 2: 가맹점/배달기사 (콜 받기)
1. **시크릿 모드** 탭 열기 (Ctrl+Shift+N / Cmd+Shift+N)
2. 같은 주소로 앱 열기
3. **가맹점 계정** 또는 **배달기사 계정**으로 로그인
4. "콜 관리" 화면에서 대기
5. 탭 1에서 결제하면 **실시간으로 콜이 나타남!** ✨

---

### 방법 2: 두 개의 브라우저 사용

#### 브라우저 1 (Chrome): 고객
1. Chrome에서 앱 열기
2. 고객 계정으로 로그인
3. 짐 보관/배달 신청 → 결제

#### 브라우저 2 (Firefox/Edge): 가맹점
1. 다른 브라우저에서 앱 열기
2. 가맹점 계정으로 로그인
3. 콜 관리 화면 열기
4. 실시간으로 콜 수신! 🔔

---

## 🔍 확인 포인트

### 1. 고객이 결제하면:

**브라우저 콘솔 (F12):**
```
📦 보관 콜 전송 완료
```
또는
```
🚚 배달 콜 전송 완료
```

**서버 터미널:**
```
📦 새로운 보관 콜 생성: #1
📢 3개 가맹점에게 콜 전송됨
```

### 2. 가맹점/배달기사 화면:

- 자동으로 새로운 콜 카드가 **실시간**으로 나타남
- 콜 정보 표시:
  - 고객 정보
  - 주소
  - 예상 금액
  - 시간 정보

### 3. 콜이 안 보이면:

**체크리스트:**
- [ ] 서버가 실행 중인가?
- [ ] 두 계정 모두 로그인했는가?
- [ ] 가맹점은 "콜 관리" 화면에 있는가?
- [ ] 배달기사는 "배달 콜" 화면에 있는가?
- [ ] 브라우저 콘솔에 에러가 없는가?

---

## 📊 콜 타입별 테스트

### 짐 보관 콜 → 가맹점
1. 고객: "짐 보관하기" 선택
2. 가맹점: "보관 요청" 화면에서 수신

### 짐 배달 콜 → 배달기사
1. 고객: "짐 배달하기" 선택
2. 배달기사: "배달 콜" 화면에서 수신

---

## 🎯 테스트 예시

### 시나리오 A: 짐 보관 테스트

**1단계: 고객 (탭 1)**
```
1. 로그인 (고객)
2. "짐 보관하기" 클릭
3. GS25 강남점 선택
4. "보관하기" 클릭
5. 결제 완료
```

**2단계: 가맹점 (탭 2 - 시크릿)**
```
1. 로그인 (가맹점)
2. "콜 관리" 화면 대기
3. 🔔 새로운 콜 나타남!
4. 콜 클릭 → 상세 정보 확인
5. "수락하기" 클릭
```

**확인:**
- ✅ 콜이 실시간으로 나타남
- ✅ 고객 정보가 정확함
- ✅ 예상 금액이 표시됨

---

### 시나리오 B: 짐 배달 테스트

**1단계: 고객 (Chrome)**
```
1. 로그인 (고객)
2. "짐 배달하기" 클릭
3. 출발지/도착지 설정
4. "배달 신청하기" 클릭
5. 결제 완료
```

**2단계: 배달기사 (Firefox)**
```
1. 로그인 (배달기사)
2. "배달 콜" 화면 대기
3. 🔔 새로운 콜 나타남!
4. 콜 클릭 → 경로 확인
5. "수락하기" 클릭
```

**확인:**
- ✅ 콜이 실시간으로 나타남
- ✅ 출발지/도착지가 정확함
- ✅ 거리와 예상 금액이 표시됨

---

## 🐛 문제 해결

### 콜이 안 나타나요!

**1. 서버 확인**
```bash
# 서버 터미널에서 확인
# 이런 메시지가 나와야 함:
📦 새로운 보관 콜 생성: #1
📢 3개 가맹점에게 콜 전송됨
```

만약 메시지가 안 나오면:
- 서버가 꺼져있음 → `cd server && npm start`
- 고객 계정의 웹소켓이 연결 안 됨 → 새로고침

**2. 가맹점 콘솔 확인**
```
F12 → Console 탭
확인할 내용:
🔔 새로운 콜 수신: {...}
✅ 가맹점 콜 목록 업데이트됨
```

메시지가 안 보이면:
- 가맹점 계정이 웹소켓 연결 안 됨
- 새로고침 후 다시 시도

**3. 계정 타입 확인**
- 짐 보관 콜 → **가맹점 계정**만 받음
- 짐 배달 콜 → **배달기사 계정**만 받음
- 고객 계정은 콜을 받지 않음!

---

## 💡 팁

### 1. 개발자 도구 활용
```
F12 → Console
- 모든 웹소켓 메시지가 로그로 표시됨
- 에러 발생 시 빨간색으로 표시
```

### 2. 서버 로그 확인
```
서버 터미널에서 실시간 로그 확인:
- 연결/연결 해제
- 콜 생성/수락/취소
- 현재 연결된 클라이언트 수
```

### 3. 빠른 테스트
```
1. 서버 실행 (한 번만)
2. 브라우저 2개 탭 열기
3. 한 탭: 고객 / 다른 탭: 가맹점
4. 고객 → 결제 → 가맹점 → 수신! ✨
```

---

## 🎉 성공 기준

✅ 고객이 결제하면 1초 이내에 가맹점에 콜이 나타남
✅ 콜 정보가 정확하게 표시됨
✅ 여러 개의 콜을 동시에 받을 수 있음
✅ 가맹점이 수락하면 다른 가맹점에서 콜이 사라짐

---

## 📞 추가 테스트 시나리오

### 1. 동시 다발 콜 테스트
- 고객 3명이 동시에 결제
- 가맹점에 3개의 콜이 모두 표시되는지 확인

### 2. 수락 테스트
- 가맹점 A가 콜 수락
- 가맹점 B, C에서 해당 콜이 사라지는지 확인

### 3. 재연결 테스트
- 가맹점 새로고침
- 웹소켓 자동 재연결되는지 확인
- 기존 콜들이 여전히 표시되는지 확인

---

## 🚀 다음 단계

테스트가 성공했다면:
1. ✅ 실시간 통신 구현 완료!
2. ✅ 다음은 푸시 알림 추가?
3. ✅ 음성 알림 추가?
4. ✅ 진동 알림 추가?

---

**Happy Testing! 🎊**
