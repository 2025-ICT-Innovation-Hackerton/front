# 🔌 웹소켓 서버 설정 가이드

## ⚠️ 중요: 반드시 순서대로 따라하세요!

---

## 1단계: 서버 실행 🖥️

### Windows
```bash
# 새 터미널(CMD 또는 PowerShell) 열기
cd server
npm install
npm start
```

### Mac/Linux
```bash
# 새 터미널 열기
cd server
npm install
npm start
```

### ✅ 성공하면 이렇게 표시됩니다:
```
🚀 짐프리 웹소켓 서버 시작 중...
🎉 웹소켓 서버가 포트 8080에서 실행 중입니다
📡 클라이언트는 ws://YOUR_IP:8080 로 연결하세요
💡 로컬: ws://localhost:8080
```

### ❌ 에러가 나면:

**"Cannot find module 'ws'"**
→ `npm install` 다시 실행

**"EADDRINUSE: address already in use"**
→ 8080 포트가 이미 사용 중. 포트 변경:
```bash
PORT=8081 npm start
```
그리고 App.tsx에서도 포트를 8081로 변경

---

## 2단계: 프론트엔드 실행 💻

서버는 **그대로 두고** 새 터미널을 하나 더 열어서:

```bash
# 프로젝트 루트 디렉토리에서
npm run dev
```

---

## 3단계: 연결 확인 ✅

브라우저 콘솔(F12)에서 이런 메시지가 나와야 합니다:

```
웹소켓 연결 시도: ws://localhost:8080
웹소켓 메시지 수신: {type: 'CONNECTED', message: '웹소켓 서버에 연결되었습니다'}
웹소켓 연결됨
```

---

## 🔴 오류 해결

### 1. "웹소켓 에러: Event {isTrusted: true, type: 'error'...}"

**원인:** 서버가 실행되지 않음

**해결:**
1. 서버 터미널 확인
2. 서버가 안 켜져있으면 `cd server && npm start`
3. 프론트엔드 새로고침

---

### 2. 무한 재연결 시도

**원인:** URL이 잘못됨

**해결:**
`/App.tsx` 74번째 줄 확인:
```typescript
url: 'ws://localhost:8080',  // ✅ 맞음 (끝에 /ws 없음)
url: 'ws://localhost:8080/ws',  // ❌ 틀림
```

---

### 3. 다른 기기에서 테스트하고 싶을 때

**1) IP 주소 확인:**

Windows:
```bash
ipconfig
```
→ "IPv4 주소" 찾기 (예: 192.168.0.23)

Mac/Linux:
```bash
ifconfig
```
→ "inet" 찾기 (예: 192.168.0.23)

**2) App.tsx 수정:**
```typescript
url: 'ws://192.168.0.23:8080',  // 실제 IP로 변경
```

**3) 같은 Wi-Fi 연결:**
두 기기가 같은 Wi-Fi에 연결되어야 합니다!

---

## 📱 테스트 방법

### 1. 고객이 짐 보관 요청:
1. 앱에서 "짐 보관하기" 선택
2. 가게 선택
3. 결제 완료

### 2. 가맹점에서 콜 받기:
1. 가맹점 계정으로 로그인
2. "콜 관리" 화면 열기
3. 실시간으로 콜이 표시됨! 🎉

### 3. 콘솔 확인:
브라우저 콘솔(F12)과 서버 터미널에서 로그 확인

**브라우저 콘솔:**
```
📦 보관 콜 전송 완료
```

**서버 터미널:**
```
📦 새로운 보관 콜 생성: #1
📢 3개 가맹점에게 콜 전송됨
```

---

## 🎯 체크리스트

연결이 안 되면 이것들을 확인하세요:

- [ ] 서버가 실행 중인가? (`cd server && npm start`)
- [ ] 프론트엔드가 실행 중인가? (`npm run dev`)
- [ ] App.tsx의 URL이 `ws://localhost:8080`인가? (끝에 `/ws` 없음)
- [ ] 브라우저 콘솔에 에러가 있는가?
- [ ] 서버 터미널에 에러가 있는가?
- [ ] 8080 포트가 다른 프로그램에 사용되고 있지는 않은가?

---

## 💡 팁

1. **서버는 항상 켜두세요**
   - 서버를 끄면 웹소켓 연결이 끊어집니다
   - 개발 중에는 서버 터미널을 항상 열어두세요

2. **로그 확인하세요**
   - 서버 터미널에서 모든 메시지를 확인할 수 있습니다
   - 브라우저 콘솔(F12)에서도 확인 가능

3. **테스트는 여러 브라우저 탭으로**
   - 탭 1: 고객 계정
   - 탭 2: 가맹점 계정
   - 탭 3: 배달기사 계정
   
   각각 다른 계정으로 로그인해서 실시간 통신 테스트!

---

## 🆘 도움이 필요하면

1. 서버 터미널의 로그를 확인
2. 브라우저 콘솔(F12)의 에러 메시지 확인
3. 위 체크리스트 다시 확인

그래도 안 되면 에러 메시지를 알려주세요!
